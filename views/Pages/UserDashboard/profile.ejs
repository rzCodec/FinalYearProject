<!doctype html>
<html >
<head >
    <%- include ../../Partials/AboveFold.ejs %>
</head >
<body >
<%- include ./partials/nav.ejs %>
<main >
    <div class="card white darken-1" style="margin-top: 5%; margin-right: 8%; margin-left: 8%" >
        <div class="card-content" >
            <%
                 user = user[0]
                 console.log(user);
            %>
            <span class="card-title left-align" ><img class="circle"
                 src="images/profilePics/<%= user.id %>.png" alt="" width="100" height="100" >&emsp;
                <%= user.firstname %> <%= user.surname %>&emsp;
                <a class="btn-flat right-aligned" href="/settings">
                    <i class="medium material-icons left-align">settings_applications</i> Edit Profile
                </a>
            </span >
            <h4 ><%= user.username %></h4 >
            <%if((user.description != "nothing for now") || (user.description != null)) {%>
            &emsp;<%=user.description%>
            <br>
            <%}%>
            <br>
            <i class="left small material-icons">music_note</i><%= user.genre%>
            <%if(user.song_link != null) {%>
            &emsp;<div><i class="left small material-icons">insert_link</i>
                <a href="<%= user.song_link%>"><%= user.song_link%></a></div>
            <%}%>
            <br>
            <i class="left small material-icons">location_on</i><%= user.city%>
            <br>

        </div >
        <%
        console.log(numFollowers);
        %>
        <p class="center-align">
            <a data-target="followers"  class="modal-trigger btn-flat">Followers: <%= numFollowers%></a>   &emsp;&emsp;
            <a data-target="following" class="btn-flat modal-trigger">Following: <%= numFollowing%></a>
        </p>
        <br>
    </div >
    <ul class="tabs center-align" style="margin-top: 3%" >

        <li id="Posts" class="tab col s3" >
            <a href="#Timeline" onclick="Materialize.showStaggeredList('#Timeline')" >
                <i class="medium material-icons right-align" >dehaze</i >Timeline
                <span id="numPosts" class="new badge" >15</span ></a ></li >

        <li id="Attended" class="tab col s3" ><a href="#AttendedEvents"
                                                 onclick="Materialize.showStaggeredList('#AttendedEvents')" >
                <i class="medium material-icons left-align" >event_available</i >Events Attended
                <span id="numUsers" class="new badge" > 15</span ></a ></li >

        <li id="Upcoming" class="tab col s3" >
            <a href="#UpcomingEvents" onclick="Materialize.showStaggeredList('#UpcomingEvents')" >
                <i class="medium material-icons right-align" >event_seat</i >Upcoming Events</a ></li >

    </ul >

    <div id="Timeline" class="col s12"
         style="margin-top: 5%;margin-bottom: 10%; margin-left: 10%; margin-right: 10%" >
        <div >

            <ul id="posts" class="collection truncate" >
                <% UserPosts.forEach(function (post) {
                %>
                <li class="collection-item avatar" >
                    <div>
                        <img src="images/profilePics/<%= post.user_id %>.png"
                             alt="<%= user.username %>" width="100" height="100" class="circle" >
                        <%var theDate = new Date(post.timestamp* 1000); %>
                        <strong><%= user.firstname %> <%= user.surname %></strong> &emsp; <%= user.username %>
                        &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;<%= theDate.getFullYear()%> <%= theDate.toLocaleTimeString()%>
                    </div>
                    </br>
                    <p ><span class="title" ><%= post.status %></span ></p>
                    </br>
                    <p > <%= post.liked %> likes  &emsp; &emsp;
                        <%= post.flag %> flags &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;
                        <a class="btn-flat right"><i class="medium material-icons tooltipped" data-tooltip="Delete Post">delete</i></a>
                    </p >
                </li >
                <% }) %>
            </ul >
        </div >
    </div >

    <div id="AttendedEvents" class="col s12 modal-trigger"
         style="margin-top: 5%;margin-bottom: 10%; margin-left: 10%; margin-right: 10%" data-target="finDetails" >
        <div >
            <ul id="posts" class="collection truncate" >
                <% console.log(UserFinishedEvents);%>
                <% UserFinishedEvents.forEach(function (event) { %>
                <li class="collection-item avatar" >
                    <div ><img src="/images/profilePics/<%= event.user_id %>.png" alt="images/empty.png"
                               class="circle" >
                        <span class="title" >Title: <%= event.title %></span >
                        <p ><%= event.description %></p ></div >
                </li >
                <% }) %>
            </ul >
        </div >
    </div >

    <div id="UpcomingEvents" class="col s12"
         style="margin-top: 5%;margin-bottom: 10%; margin-left: 10%; margin-right: 10%" >
        <div >
            <ul id="posts" class="collection truncate" >
                <% UserUpcomingEvents.forEach(function (event) {  %>

                <li class="collection-item avatar" >
                    <div ><img src="/images/profilePics/<%= event.user_id %>.png" alt="images/empty.png"
                               class="circle" >
                        <span class="title" >Title: <%= event.title %></span >
                        <p ><%= event.description %></p ></div >
                </li >
                <% }) %>
            </ul >
        </div >
    </div >


    <div id="finDetails" class="modal">
        <div class="modal-content">
            <div class="card-content">
                Event Name:
                Event Details
                Event Date
                Overall Ratig for event
                <br>
                Users: + Skill and Rating
                <br>
                Comments ordered by User
            </div>
        </div>

    </div>

    <div id="upcomingDetails" class="modal">
        <div class="modal-content">
            <div class="card-content">
                Event Name:
                Event Details
                Event Date
                <br>
                Users: + Skill
            </div>
        </div>
    </div>


    <div id="followers" class="modal">
        <div class="modal-panel">
            <h2 class="card-title" style="margin-bottom: 10%"> Followers </h2>
            <ul>
                <li class="card-content"></li>
            </ul>
        </div>
    </div>

    <div id="following" class="modal">
        <div class="modal-panel">
            <h2 class="card-title" style="margin-bottom: 10%"> Followers </h2>
            <ul>
                <li class="card-content"></li>
            </ul>
        </div>
    </div>




</main >
<%- include ../../Partials/footer.ejs %>
<script >

    var numFollowers, numFollowing;
    function getFollowers()
    {
        $.ajax({
            type: "GET",
            url: "https://eternalvibes.me/getFriends/" + user.id,
            cache: false,
            dataType: "jsonp",
            success: function (data){
                console.log(data);
                numFollowers = data;
            },
            error: function (data) {
                console.log("error");
                numFollowers = data;
            }}).then(function()
        {
            return numFollowers;
        });
    }
    function getFollowing()
    {
        $.ajax({
            type: "GET",
            url: "https://eternalvibes.me/getFollowing/",
            cache: false,
            data:user.id,
            dataType: "jsonp",
            success: function (data)
            {
                console.log(data);
                numFollowing = data;
            },
            error: function (data)
            {
                console.log("error");
                numFollowing = data;
            }}).then(function()
        {
            return numFollowing;
        });
    }



    $(document).ready(function(){
        $('.modal').modal();
        getFollowers();
        getFollowing();
    });
  $('#Timeline').click(getPosts())
  $('#Attended').click(getAttended())
  $('#Upcoming').click(getUpcoming())

  $(document).ready(function () {
    $('ul.tabs').tabs()
  })
  $(document).ready(function () {
    $('ul.tabs').tabs('select_tab', '')
  })
  Materialize.showStaggeredList('')

</script >
</body >
</html >